import argparse

import os
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

parser = argparse.ArgumentParser()
parser.add_argument('--planning_time_data', type=str, required=True,
                    help="Path to the jsonl file containing the planning time "
                    "data, generated by collect_planning_time.py")
parser.add_argument('--out_dir', type=str, required=True,
                    help="Path to the directory where the output plots "
                    "will be saved")

args = parser.parse_args()

df = pd.read_csv(args.planning_time_data)

def get_model(row):
    if row['dsl'] == 0:
        return "GPT"
    else:
        return "T5"

df["Model"] = df.apply(get_model, axis=1)

fig, ax = plt.subplots(figsize=(5, 2.5))
ax = sns.boxplot(x="gbs", y="time", data=df, hue="Model", hue_order=["GPT", "T5"], showfliers=False)
# ax.set_ylim([0, 250])
ax.set_xlabel("Global Batch Size (Tokens)")
ax.set_ylabel("Time Per Iteration (s)")

for item in ([ax.title, ax.xaxis.label, ax.yaxis.label] +
             ax.get_xticklabels() + ax.get_yticklabels()):
    item.set_fontsize(12)

plt.setp(ax.get_legend().get_texts(), fontsize='12') # for legend text
plt.setp(ax.get_legend().get_title(), fontsize='12') # for legend title

plt.savefig(os.path.join(args.out_dir, "fig16.pdf"), bbox_inches='tight')